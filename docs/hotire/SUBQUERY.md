# SubQuery

하나의 SQL안에 또 다른 SQL을 말한다. 메인 쿼리가 서브쿼리를 포함하눈 종속관계이다. 

단위 처리별로 쿼리를 독립시킬수있고, 쿼리의 가독성이 올라가기도 한다. 

하지만 효울이 좋지 못한 경우가 많다.

## 상관 서브 쿼리

서브 쿼리 외부, 메인 쿼리에서 정의된 테이블의 칼럼을 참조해서 검색할때 상관 서브 쿼리라고 한다.

외부 쿼리가 실행 되고 값이 전달되어야 서브 쿼리를 실행할 수 있다.

## 독립 서브 쿼리

외부 쿼리의 칼럼을 사용하지 않고 서브 쿼리에서 정의된 칼럼만 참조할 때 독립 서브 쿼리라고 한다. 
독립 서브 쿼리는 외부의 쿼리와 상관없이 항상 같은 결과를 반환하므로 외부 쿼리보다 먼저 실행되어 외부 쿼리의 검색을 위한 상수로 사용되는 것이 일반적이다. 

## 제약 사항

- 서브 쿼리를 IN 연산자와 함께 사용할 때에는 효율적으로 처리되지 못한다.
- IN 연산자 안에서 사용하는 서브 쿼리에는 ORDER BY 와 LIMIT를 동시에 사용할 수 없다.
- FROM 절에 사용하는 서브 쿼리는 상관 서브 쿼리 형태로 사용할 수 없다
- 서브쿼리를 이용해 테이블에 읽고 쓰기를 할 수 없다. 이럴 경우 임시 테이블 사용하도록 우회할수있다.



### SELECT 절에 사용된 서브 쿼리

SELECT 절에 사용된 서브 쿼리는 내부적으로 임시 테이블을 만들거나 쿼리를 비효율적으로 실행하도록 만들지 않기 때문에 서브 쿼리가 적절히 인덱스를 사용할 수 있다면 크게 주의할 사항은 없다. 

SELECT 절에 서브 쿼리를 사용하면 그 서브 쿼리는 항상 칼럼과 레코드가 하나인 결과를 반환해야 한다. 그 값이 NULL이든 아니든 관계없이 레코드가 1건이 존재해야 한다는 것이다.

### WHERE 절에 단순 비교를 위해 사용된 서브 쿼리

### From 절에 사용한 서브 쿼리

FROM 절에 사용된 서브 쿼리는 항상 임시 테이블을 사용하므로 제대로 최적화되지 못하고 비효율적일 때가 많다.



## References

- https://weicomes.tistory.com/325?category=669169
- https://weicomes.tistory.com/327?category=669169