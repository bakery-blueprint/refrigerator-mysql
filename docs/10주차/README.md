# 부록 A - MYSQL 5.1(InnoDB Plugin 1.0)의 새로운 기능

## A.1. MySQL 5.1의 새로운 기능

### A.1.1. 파티션
- 하나의 테이블이 너무 커서 인덱스의 크기가 물리적인 메모리보다 훨씬 크거나, 데이터 특성상 주기적인 삭제 작업이 필요한 경우에 쓰임

### A.1.2. 레코드 기반의 복제(Row-based replication)
- 이전 버전의 경우 InnoDB 스토리지 엔진의 캡락이나 넥스트 키락을 유발해 동시성을 떨어트릴뿐만 아니라, 부동소수점의 값을 슬레이브 MySQL서버에 제대로 전달하지 못하는 문제점
- 이후 버전(레코드 기반 복제)의 경우 캡락이나 넥스트 키락과 같은 레인지 락의 사용을 최소화 할수 있으며, AUTO_INCREMENT나 부동소수점등 여러가지 문제점을 해결
- 문장기반의 복제(Statement-based replication)과 레코드 기반의 복제(Row-based replication) 혼합하여 사용가능

### A.1.3. 플로그인 API
- 모든 스토리지 엔진이 플러그인 방식으로 사용될 수 있게 아키텍처가 바뀜

### A.1.4. 이벤트 스케줄러
- 운영체제별로 지원하는 스케줄러가 아닌 MySQL에서의 배치나 통계 작업으로 사용가능

### A.1.5. 서버 로그 테이블
- 슬로우 쿼리 로그나 제너럴 쿼리 로그를 파일 뿐 아니라 테이블로도 저장할 수 있도록 개선

## A.2. InnoDB 플러그인 1.0의 새로운 기능
- MySQL 5.1 버전의 경우 스토리지 엔진에 플로그인을 적용한 버전인데, 과도기적인 특성으로 내장 InnoDB 스토리지 엔진과 플러그인 방식의 InnoDB 스토리지 엔진을 함께 포함

### A.2.1. InnoDB의 빠른 인덱스 생성
- 기존 MySQL 5.0의 InnoDB의 경우 인덱스 생성시 기존 테이블의 모든 데이터를 복사하고 인덱스를 생성하는 방식이었으나, 이후 버전에서는 인덱스 자체만 생성하는 방법으로 개선

### A.2.2. InnoDB 데이터 압축
- 기존 대부분은 DBMS 작업은 디스크의 I/O에 의존적일 때가 많아서 디스크의 성능에 좌지우지 하나, InnoDB 플러그인의 데이터 압춥기술로 디스크로부터 읽고 써야하는 데이터의 양을 경감시키는 기술을 발전시킴

### A.2.3. BLOB이나 TEXT 타입 관리
- BLOB이나 TEXT 타입의 칼럼값을 새로운 페이지에 저장(off-page) 
- off-page에 저장조건
    - innoDB 플러그인에서 파일 포맷으로 "Barracuda"를 사용
    - ㄱROW_FORMAT을 "DYNAMIC" 또는 "COMPRESSED"로 설정

### A.2.4. InnoDB 파일 포맷 관리
- 파일 포맷명
    - Barracuda : 새로운 파일 포맷
    - Antelope : 이전 파일 포맷
- 새로운 데이터 파일 포맷 반드시 사용해야할 것
    - InnoDB 데이터 압축
    - BLOB이나 TEXT 타입의 칼럼을 레코드의 다른 일반 컬럼(BLOB/TEXT 제외)과 완전히 분리된 블록에 저장

### A.2.5. InnoDB INFORMATION_SCHEMA 테이블
- 테이블의 압축이나 잠금에 대한 정보를 보여주는 테이블

### A.2.6. 확장성 개선을 위한 빠른 잠금 처리
- Mutex + RW-Lock = 래치(경량화된 잠금)
- InnoDB 플러그인이 적용된 MySQL 5.1부터는 CPU의 Atomic-operation을 사용해 기존의 Pthread mutex보다 훨씩 효율적으로 여러 스레드의 동기화를 처리

### A.2.7. 운영체제의 메모리 할당 기능 사용
- 운영체제에서 제공하는 메모리 할당 기능을 사용할지 InnoDB에 내장된 메모리 할당 기능을 사용할지 결정

### A.2.8. InnoDB 인서트 버퍼 제어
- 보조 인덱스 즉시 반영하지않고 인서트 버퍼에 넣어두는 것을 제어

### A.2.9. Adaptive Hash Index 제어
- 동시 다발적인 조인과 같은 쿼리가 빈번하게 실행되는경우 부하기 높은 시스템에서는 Adaptive Hash Index의 접근을 동기화 하여 잠금 경합의 원인이 되는데,,이를 제어할수 있게되었음

### A.2.10. Read Ahead 알고리즘의 개선

### A.2.11. 다중 백그라운드 I/O 스레드
- innodb_read_to_threads와 innodb_write_to_threads 시스템 설정을 이용해 읽기와 쓰기 전용 스래드 개수 조절

### A.2.12. 그룹 커밋
- 여러 클라이언트가 동시에 트랜젝션 커밋을 할때 디스크의 I/O 부하가 높아지기 때문에 그룹커밋을통해 일괄적으로 처리하도록 개선

### A.2.13. 마스터 스레드의 I/O 성능 제어
- MySQL 5.0에서는 마스터 스레드의 입출력 조작 가능횟수를 설정(100)을 하지못하나, MySQL 5.1 부터는 설정 가능

### A.2.14. 더티 페이지의 플러시 제어
- innodb_max_dirty_pages_pet 시스템 설정으로 버퍼 풀에 남아있는 더티 페이지 비율을 조절
- 해당 설정값을 넘어가게되면 과도한 디스크 I/O가 발생하여 쿼리 처리속도가 느려질수 있는 원인 발생
- innodb_adaptive_flushing 시스템 설정을 통해서 해당 디스크 처리 속도 조절가능

### A.2.15. Spin loop에서 Pause 사용
- 스레드가 과도하게 Spin loop를 실행하면 CPU의 자원이 낭비될 수 있는데, PAUSE라는 명령을 통해 CPU의 자원 소모 없이 Spin loop를 수행할 수 있는 기능을 제공

### A.2.16. 버퍼 풀의 관리 기능 개선
- innodb_old_blocks_time라는 시스템 설정을 이욯애 LRU리스트에서 MRU리스트로 옯겨지기 전에 잠깐 대기하게 할 수 있는 기능을 추가

### A.2.17. 여러 시스템 설정의 동적인 제어
- 시스템 설정값을 변경하려면 서버를 재시작해야 하지만 서버 재시작 없이 처리되도록 개선

### A.2.18. TRUNCATE TABLE 시에 테이블 스페이스 공간 반납
- 기존에는 TRUNCATE TABLE 할때 디스 공간을 운영체제에 반납하지 않았지만, 이후에는 반납하는것으로 개선

### A.2.19. InnoDB의 통계 수집을 위한 페이지 샘플링수 조절
- MySQL 5.0에서는 통계정보를 수집을 할떄 8개의 페이지를 샘플링해서 분석하고 통계 정보를 수립
- innodb_stats_sample_pages 시스템 설정에 분석할 페이지의 개수를 설정 가능

# 부록 B - MYSQL 5.5(InnoDB Plugin 1.1)의 새로운 기능

## B.1. MySQL 서버의 개선사항

### B.1.1. 스레드 풀
- 기존에는 커넥션의 수와 스레드의 수가 1:1 이었으나 스레드 풀을 이용해 요청된 쿼리나 처리돼야 하는 커넥션에만 스레드를 할당하는 형태로 개선 

### B.1.2. 사용자 인증 플러그인 아키텍처
- 사용자가 개별적으로 개발해서 적용할수 있도록 개선 

### B.1.3. 반동기 복제(Semi-synchronous Replication)
- 마스터 MySQL은 항상 트랜잭션이 커밋되기 전에 그 트랜잭션과 관련된 모든 바이너리 로그가 슬레이브로 전달됐는지 확인
- 마스터 MySQL에서 커밋된 트랜잭션은 반드시 슬레이브 MySQL 릴레이 로그로 전달됐음을 보장
- 하지만 슬레이브로 전달됐다고 해서 실행됬다는것을 보장하지는 않음 > 여러 대의 슬레이브 MySQL서버중에서 하나의 슬레이브만이라도 바이너리 로그가 안정적으로 전달되면 커밋이 완료 된다는 것은 꼭 기억!

### B.1.4. 유니코드 지원 확장
- 5.1버전까지는 3byte UTF-8 > 

### B.1.5. 기본 스토리지 엔진의 변경
- 기본 스토리지 엔진 InnoDB로 변경

### B.1.6. SIGNAL과 RESIGINAL 기능 추가
- 자바 프로그램음 throw 처럼 예외를 의도적으로 만들 수 있는 기능 추가

### B.1.7. 파티션 기능 개선
- 파티션 키 숫자 타입의 컬럼 or 표현식 > 숫자타입이 아닌 컬럼 or 표횬식으로도 생성 할 수 있도록 개선  

## B.2. InnoDB 플러그인 1.1의 개선 사항

## B.2.1. 인덱스 생성 방식 변경
- 인덱스 키를 정렬하기 떄문에 인덱스의 크기나 프레그맨테이션을 최소화 할수 있다는 장점이 있음

## B.2.2. 트랜잭션 복구 성능 향상

## B.2.3. InnoDB 성능 진단을 위한 PERFORMANCE_SCHEMA
- 각종 이벤트를 수집하는 테이블을 모아둔 DB

## B.2.4. 다중 버퍼 풀
- 단일 버퍼 풀에 대한 경합이 많아지고 별목 지점이 될가능성이 높아 사용자가 버퍼 풀 개수 설정 가능하도록 개선

## B.2.5. 다중 롤백 세그먼트
- 기존에는 데이터를 동시에 변경하는 트랜잭션은 1023개까지만 허용
- 롤백 세그먼트 1023개에서 131,072개로 확장

## B.2.6. 버퍼 풀 관련 뮤텍스 개선
- 뮤텍스 : 버퍼 풀의 페이지를 변경하는 작업과 버퍼 풀의 플러시 리스트를 관리하는 작업
- 버퍼 풀의 변경 작업과 플러시 리스트를 관리하는 뮤텍스 분리로 인해 불필요한 잠금 대기나 처리 지연 개선

## B.2.7. 인서트 버퍼 처리 개선
- INSERT뿐 아니라 DELETE로 인한 보조 인덱스 키 삭제 작업에도 인서트 버퍼를 이용할수 있게 개선

## B.2.8. 비동기화된 디스크 I/O
- 기존에는 리눅스계열의 운영체제에서 동기화 방식이었으나 비동기화 방식으로 개선

# 부록 C - MYSQL 5.6 새로운 기능
## C.1. InnoDB 테이블을 이한 풀 텍스트 검색
- 기존에는 원본테이블에서 MyISAM 테이블로 복사하는 형태로 전문 검색을 사용
- InnoDB 테이블에 전문 검색 인덱스를 생성

## C.2. InnoDB의 리두 로그 파일 크기
- 리두 파일 크기 4GB > 2TB 까지 허용

## C.3. 언두 테이블 스페이스
- 언두 데이터에 자체적으로 별도 테이블 스페이스를 사용 할 수 있게 개선하여, 언두 데이터 전용 디스크를 할당하거나 SSD를 적용해 최적화할 수 있게 됬음

## C.4. InnoDB 버퍼 풀의 다동 워밍 업
- 이전 버전 MySQL(5.1/5.5)에서는 MySQL 서버를 재시작한 후 풀 테이블 스캔을 이용해 테이블의 데이터를 버퍼 풀로 적재하는 워밍 업 작업을 해줘야 할때가 많음
- MySQL 서버가 시작되면서 버퍼풀의 데이터 페이지 리스트를 읽어서 버퍼풀을 워밍업하도록 기능 추가
    - 백업되는 페이지 리스트에는 데이터 페이지 주소만 저장되서 디스크를 많이 사용하지 않고 워밍업 가능


## C.5. InnoDB의 페이지 크기 조정
- 페이지 크기를 4kb, 8kb, 16kb, 64kb 까지 사용자가 설정할수 있도록 개선 

## C.6. 멀티 스테드 슬레이브
- MySQL에서 2개 이상의 스레드를 사용해 병렬로 북제를 수행하도록 기능 개선

## C.7. Memcached를 통한 NoSQL 확장
